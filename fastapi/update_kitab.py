from database import translations_collection

# 97 Kitab definitions: (start, end, arabic, thai)
KITAB_MAPPINGS = [
    (1, 7, "كِتَابُ بَدْءِ الوَحْي", "หมวดที่ 1: การเริ่มของวะหฺยู"),
    (8, 58, "كِتَابُ الإِيْمَانِ", "หมวดที่ 2: ความศรัทธา"),
    (59, 134, "كِتَابُ العِلْمِ", "หมวดที่ 3: ความรู้"),
    (135, 247, "كِتَابُ الوُضُوْءِ", "หมวดที่ 4: การอาบน้ำละหมาด"),
    (248, 293, "كِتَابُ الغُسْلِ", "หมวดที่ 5: การอาบน้ำ"),
    (294, 333, "كِتَابُ الحَيْضِ", "หมวดที่ 6: ประจำเดือน"),
    (334, 348, "كِتَابُ التَّيَمُّمِ", "หมวดที่ 7: การตะยัมมุม"),
    (349, 520, "كِتَابُ الصَّلَاةِ", "หมวดที่ 8: การละหมาด"),
    (521, 602, "كِتَابُ مَوَاقِيْتِ الصَّلَاةِ", "หมวดที่ 9: เวลาละหมาด"),
    (603, 875, "كِتَابُ الأَذَانِ", "หมวดที่ 10: การอะซาน"),
    (876, 941, "كِتَابُ الجُمْعَةِ", "หมวดที่ 11: ละหมาดวันศุกร์"),
    (942, 947, "كِتَابُ صَلَاةِ الخَوْفِ", "หมวดที่ 12: ละหมาดเคาฟฺ"),
    (948, 989, "كِتَابُ العِيْدَيْنِ", "หมวดที่ 13: วันอีดทั้งสอง"),
    (990, 1004, "كِتَابُ الوِتْرِ", "หมวดที่ 14: ละหมาดวิตรฺ"),
    (1005, 1039, "كِتَابُ الإِسْتِسْقَاءِ", "หมวดที่ 15: การขอฝน"),
    (1040, 1066, "كِتَابُ الكُسُوْفِ", "หมวดที่ 16: สุริยุปราคาและจันทรุปราคา"),
    (1067, 1079, "كِتَابُ سُجُودِ القُرآنِ", "หมวดที่ 17: สุญูดกุรอาน"),
    (1080, 1119, "كِتَابُ التَّقْصِيْرِ الصَّلَاةِ", "หมวดที่ 18: ละหมาดย่อ"),
    (1120, 1187, "كِتَابُ التَّهَجُّدِ", "หมวดที่ 19: ละหมาดตะฮัจญุด"),
    (1188, 1197, "كِتَابُ فَضْلِ الصَّلَاةِ فِي مَسْجِدِ مَكَّةَ وَالمَدِيْنَةِ", "หมวดที่ 20: ความประเสริฐของการละหมาดที่มัสญิดมักกะฮฺและมะดีนะฮฺ"),
    (1198, 1223, "كِتَابُ العَمَلِ فِي الصَّلَاةِ", "หมวดที่ 21: การปฏิบัติในละหมาด"),
    (1224, 1236, "كِتَابُ السَّهْوِ", "หมวดที่ 22: หลงลืมในละหมาด"),
    (1237, 1394, "كِتَابُ الجَنَائِزِ", "หมวดที่ 23: ญะนาซะฮฺ"),
    (1395, 1512, "كِتَابُ الزَّكَاةِ", "หมวดที่ 24: ซะกาต"),
    (1513, 1772, "كِتَابُ الحَجِّ", "หมวดที่ 25: หัจญ์"),
    (1773, 1805, "كِتَابُ العُمْرَةِ", "หมวดที่ 26: อุมเราะฮฺ"),
    (1806, 1820, "كِتَابُ المُحْصَرِ", "หมวดที่ 27: ผู้ที่มีอุปสรรคกีดขวาง"),
    (1821, 1866, "كِتَابُ جَزَاءِ الصَّيْدِ", "หมวดที่ 28: โทษของการล่าสัตว์"),
    (1867, 1890, "كِتَابُ فَضَائِلِ المَدِيْنَةِ", "หมวดที่ 29: ความประเสริฐของเมืองมะดีนะฮฺ"),
    (1891, 2007, "كِتَابُ الصَّوْمِ", "หมวดที่ 30: การถือศีลอด"),
    (2008, 2013, "كِتَابُ صَلَاةِ التَّرَاوِيْحِ", "หมวดที่ 31: ละหมาดตะรอวีหฺ"),
    (2014, 2024, "كِتَابُ فَضْلِ لَيْلَةِ القَدْرِ", "หมวดที่ 32: ความประเสริฐของลัยละตุลก็อดรฺ"),
    (2025, 2046, "كِتَابُ الإِعْتِكَافِ", "หมวดที่ 33: อิอฺติกาฟ"),
    (2047, 2238, "كِتَابُ البُيُوْعِ", "หมวดที่ 34: การซื้อขาย"),
    (2239, 2256, "كِتَابُ السَّلَمِ", "หมวดที่ 35: การซื้อขายล่วงหน้า"),
    (2257, 2259, "كِتَابُ الشُّفْعَةِ", "หมวดที่ 36: การโอนย้ายสิทธิ์"),
    (2260, 2286, "كِتَابُ الإِجَارَةِ", "หมวดที่ 37: การเช่าหรือจ้าง"),
    (2287, 2289, "كِتَابُ الحَوَالَاتِ", "หมวดที่ 38: การถ่ายโอนหนี้"),
    (2290, 2298, "كِتَابُ الكَفَالَةِ", "หมวดที่ 39: การค้ำประกัน"),
    (2299, 2319, "كِتَابُ الوَكَالَةِ", "หมวดที่ 40: การมอบอำนาจ"),
    (2320, 2350, "كِتَابُ المُزَارَعَةِ", "หมวดที่ 41: การเพาะปลูก"),
    (2351, 2384, "كِتَابُ المُسَاقَاةِ", "หมวดที่ 42: การให้น้ำ"),
    (2385, 2409, "كِتَابُ فِي الإِسْتِقْرَاضِ وَأَدَاءِ الدُّيُوْنِ وَالحَجْرِ وَالتَّفْلِيْسِ", "หมวดที่ 43: การกู้ยืม การชำระหนี้ การอายัดทรัพย์ และการล้มละเลย"),
    (2410, 2425, "كِتَابُ الخُصُوْمَاتِ", "หมวดที่ 44: การพิพาท"),
    (2426, 2439, "كِتَابُ اللُّقَطَةِ", "หมวดที่ 45: ทรัพย์สินที่ตกหล่นหรือหาย"),
    (2440, 2482, "كِتَابُ المَظَالِمِ وَالغَضْبِ", "หมวดที่ 46: การอธรรมและการโกรธเคือง"),
    (2483, 2507, "كِتَابُ الشَّرِكَةِ", "หมวดที่ 47: การหุ้นส่วน"),
    (2508, 2516, "كِتَابُ الرَّهْنِ", "หมวดที่ 48: การจำนำและจำนอง"),
    (2517, 2559, "كِتَابُ العِتْقِ", "หมวดที่ 49: การปลดปล่อยทาส"),
    (2560, 2565, "كِتَابُ المُكَاتَبِ", "หมวดที่ 50: ทาสที่ไถ่ตัวเอง"),
    (2566, 2636, "كِتَابُ الهِبَةِ وَفَضْلِهَا وَالتَّحْرِيْضُ عَلَيْهَا", "หมวดที่ 51: การยกให้ คุณค่าและการส่งเสริมให้กระทำ"),
    (2637, 2689, "كِتَابُ الشَّهَادَاتِ", "หมวดที่ 52: การเป็นพยาน"),
    (2690, 2710, "كِتَابُ الصُّلْحِ", "หมวดที่ 53: การประนีประนอม"),
    (2711, 2737, "كِتَابُ الشُّرُوْطِ", "หมวดที่ 54: เงื่อนไขต่าง ๆ"),
    (2738, 2781, "كِتَابُ الوَصَايَا", "หมวดที่ 55: คำสั่งเสียหรือพินัยกรรม"),
    (2782, 3090, "كِتَابُ الجِهَادِ وَالسِّيَرِ", "หมวดที่ 56: การญิฮาดและการสำรวจ"),
    (3091, 3155, "كِتَابُ فَرْضِ الخُمُسِ", "หมวดที่ 57: บัญญัติเกี่ยวกับคุมุส"),
    (3156, 3189, "كِتَابُ الجِزْيَةِ", "หมวดที่ 58: ญิซยะฮฺ"),
    (3190, 3325, "كِتَابُ بَدْءِ الخَلْقِ", "หมวดที่ 59: การเริ่มของสิ่งถูกสร้าง"),
    (3326, 3488, "كِتَابُ أَحَادِيْثِ الأَنْبِيَاءِ", "หมวดที่ 60: หะดีษต่าง ๆ เกี่ยวกับบรรดานบี"),
    (3489, 3648, "كِتَابُ المَنَاقِبِ", "หมวดที่ 61: คุณธรรมทั้งหลาย"),
    (3649, 3775, "كِتَابُ فَضَائِلِ الصَّحَابَةِ", "หมวดที่ 62: ความประเสริฐของบรรดาเศาะหาบะฮฺ"),
    (3776, 3948, "كِتَابُ مَنَاقِبِ الأَنْصَارِ", "หมวดที่ 63: คุณธรรมของชาวอันศอร"),
    (3949, 4473, "كِتَابُ المَغَازِي", "หมวดที่ 64: สงคราม"),
    (4474, 4977, "كِتَابُ التَّفْسِيْرِ", "หมวดที่ 65: อรรถาธิบายอัลกุรอาน"),
    (4978, 5062, "كِتَابُ فَضَائِلِ القُرْآنِ", "หมวดที่ 66: คุณค่าของอัลกุรอาน"),
    (5063, 5250, "كِتَابُ النِّكَاحِ", "หมวดที่ 67: การแต่งงาน"),
    (5251, 5350, "كِتَابُ الطَّلَاقِ", "หมวดที่ 68: การหย่าร้าง"),
    (5351, 5372, "كِتَابُ النَّفَقَاتِ", "หมวดที่ 69: นัฟเกาะฮฺ"),
    (5373, 5466, "كِتَابُ الأَطْعِمَةِ", "หมวดที่ 70: อาหาร"),
    (5467, 5474, "كِتَابُ العَقِيْقَةِ", "หมวดที่ 71: อะกีเกาะฮฺ"),
    (5475, 5544, "كِتَابُ الذَّبَائِحِ وَالصَّيْدِ", "หมวดที่ 72: การเชือดและล่าสัตว์"),
    (5545, 5574, "كِتَابُ الأَضَاحِي", "หมวดที่ 73: การเชือดสัตว์พลี"),
    (5575, 5639, "كِتَابُ الأَشْرِبَةِ", "หมวดที่ 74: เครื่องดื่ม"),
    (5640, 5677, "كِتَابُ المَرْضَى", "หมวดที่ 75: การเจ็บป่วย"),
    (5678, 5782, "كِتَابُ الطِّبِّ", "หมวดที่ 76: การรักษา"),
    (5783, 5969, "كِتَابُ اللِّبَاسِ", "หมวดที่ 77: เครื่องแต่งกาย"),
    (5970, 6226, "كِتَابُ الأَدَبِ", "หมวดที่ 78: มารยาท"),
    (6227, 6303, "كِتَابُ الإِسْتِئْذَانِ", "หมวดที่ 79: การขออนุญาต"),
    (6304, 6411, "كِتَابُ الدَّعَوَاتِ", "หมวดที่ 80: การขอดุอาอ์"),
    (6412, 6593, "كِتَابُ الرِّقَاقِ", "หมวดที่ 81: สิ่งที่ทำให้จิตใจอ่อนโยน"),
    (6594, 6620, "كِتَابُ القَدَرِ", "หมวดที่ 82: การกำหนดของอัลลอฮฺ"),
    (6621, 6707, "كِتَابُ الأَيْمَانِ وَالنُّذُوْرِ", "หมวดที่ 83: การสาบานและการบนบาน"),
    (6708, 6722, "كِتَابُ كَّفَّارَاتِ الأَيْمَانِ", "หมวดที่ 84: การชดเชยต่อคำสาบาน"),
    (6723, 6771, "كِتَابُ الفَرَائِضِ", "หมวดที่ 85: การแบ่งมรดก"),
    (6772, 6860, "كِتَابُ الحُدُوْدِ", "หมวดที่ 86: บทลงโทษ"),
    (6861, 6917, "كِتَابُ الدِّيَاتِ", "หมวดที่ 87: การจ่ายสินไหม"),
    (6918, 6939, "كِتَابُ اِسْتِتَابَةِ المُرْتَدِّيْنَ وَالمُعَانِدِيْنَ وَقِتَالِهِمْ", "หมวดที่ 88: การเรียกร้องให้ผู้ที่ทิ้งศาสนาและพวกกบฏกลับเนื้อกลับตัว"),
    (6940, 6952, "كِتَابُ الإِكْرَاهِ", "หมวดที่ 89: การบังคับ"),
    (6953, 6981, "كِتَابُ الحِيَلِ", "หมวดที่ 90: การใช้เล่ห์เหลี่ยม"),
    (6982, 7047, "كِتَابُ التَّعْبِيْرِ", "หมวดที่ 91: การอธิบายฝัน"),
    (7048, 7136, "كِتَابُ الفِتَنِ", "หมวดที่ 92: ฟิตนะฮฺต่าง ๆ"),
    (7137, 7225, "كِتَابُ الأَحْكَامِ", "หมวดที่ 93: บทบัญญัติต่าง ๆ"),
    (7226, 7245, "كِتَابُ التَّمَنِّى", "หมวดที่ 94: การคาดหวัง"),
    (7246, 7267, "كِتَابُ أَخْبَار الآحَادِ", "หมวดที่ 95: รายงานอาหาด"),
    (7268, 7370, "كِتَابُ الإِعْتِصَامِ بِالكِتَابِ وَالسُّنَّةِ", "หมวดที่ 96: การยึดมั่นต่อคัมภีร์และอัสสุนนะฮฺ"),
    (7371, 7563, "كِتَابُ التَّوْحِيْدِ", "หมวดที่ 97: การให้เอกภาพแด่อัลลอฮฺ"),
]

def get_kitab(hadith_num):
    """Find appropriate kitab for a hadith number."""
    for start, end, ar, th in KITAB_MAPPINGS:
        if start <= hadith_num <= end:
            return ar, th
    return None, None

def update_all_kitab():
    print("Starting Kitab metadata update...")
    
    cursor = translations_collection.find({})
    updated = 0
    
    for doc in cursor:
        hadith_id = doc.get("hadith_id", "")
        
        # Extract number from hadith_id (e.g., "bukhari_123" -> 123)
        try:
            num = int(hadith_id.replace("bukhari_", ""))
        except:
            print(f"Skipping {hadith_id} - cannot parse number")
            continue
        
        ar, th = get_kitab(num)
        
        # Build update dict
        update_data = {
            "hadith_book": "bukhari",  # Book identifier
            "hadith_no": str(num),  # Store hadith number
            "hadith_status": doc.get("hadith_status") or "เศาะฮีหฺ",  # Default status if not set
        }
        
        if ar and th:
            update_data["kitab.ar"] = ar
            update_data["kitab.th"] = th
        
        translations_collection.update_one(
            {"_id": doc["_id"]},
            {"$set": update_data}
        )
        updated += 1
            
        if updated % 500 == 0:
            print(f"Updated {updated} documents...")
    
    print(f"Update complete. Total updated: {updated}")

if __name__ == "__main__":
    update_all_kitab()

---
import AdminLayout from "../../layouts/AdminLayout.astro";
import CategoryEditModal from "../../components/admin/CategoryEditModal.astro";
import { getCategories } from "../../lib/api";

let categories: any[] = [];
try {
    const res = await getCategories();
    categories = res.categories;
} catch (e) {
    console.error("Failed to fetch categories:", e);
}
---

<AdminLayout title="จัดการหมวดหมู่บทความ">
    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-2xl font-bold text-gray-800">หมวดหมู่บทความ</h1>
            <p class="text-gray-500">จัดการหมวดหมู่สำหรับจัดกลุ่มบทความ</p>
        </div>
        <button
            onclick="openCategoryModal()"
            class="px-4 py-2 bg-primary text-white rounded-xl hover:bg-primary-dark transition-colors flex items-center gap-2 shadow-lg shadow-primary/30"
        >
            <span>+</span> เพิ่มหมวดหมู่
        </button>
    </div>

    <!-- Categories List -->
    <div
        class="bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden"
    >
        <table class="w-full text-left">
            <thead class="bg-gray-50 text-gray-500 text-xs uppercase">
                <tr>
                    <th class="px-6 py-3">ชื่อหมวดหมู่</th>
                    <th class="px-6 py-3">Slug</th>
                    <th class="px-6 py-3">จำนวนบทความ</th>
                    <th class="px-6 py-3 text-right">จัดการ</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
                {
                    categories.length === 0 ? (
                        <tr>
                            <td
                                colspan="4"
                                class="px-6 py-8 text-center text-gray-500"
                            >
                                ยังไม่มีหมวดหมู่
                            </td>
                        </tr>
                    ) : (
                        categories.map((cat) => (
                            <tr class="hover:bg-gray-50 transition-colors">
                                <td class="px-6 py-4">
                                    <div class="font-medium text-gray-800">
                                        {cat.name}
                                    </div>
                                    <div class="text-xs text-gray-400">
                                        {cat.description}
                                    </div>
                                </td>
                                <td class="px-6 py-4">
                                    <code class="bg-gray-100 px-2 py-1 rounded text-xs text-secondary">
                                        {cat.slug}
                                    </code>
                                </td>
                                <td class="px-6 py-4 text-sm text-gray-500">
                                    -
                                </td>
                                <td class="px-6 py-4 text-right">
                                    <button
                                        class="px-3 py-1 text-sm bg-gray-100 text-gray-600 rounded-lg hover:bg-primary hover:text-white transition-colors"
                                        onclick={`openCategoryModal(${JSON.stringify(cat)})`}
                                    >
                                        แก้ไข
                                    </button>
                                </td>
                            </tr>
                        ))
                    )
                }
            </tbody>
        </table>
    </div>

    <CategoryEditModal />
</AdminLayout>

---
import BaseLayout from "../../layouts/BaseLayout.astro";

// Handle Login Submission
if (Astro.request.method === "POST") {
    try {
        const data = await Astro.request.formData();
        const key = data.get("key");
        const validKey = import.meta.env.ADMIN_SECRET || "bismillah"; // Simple backup key

        if (key === validKey) {
            // Set cookie manually
            // Note: HttpOnly is safer but then client JS can't read it for UI state easily.
            // For this simple app, exposing it to JS is fine for now as we check layout logic server-side too.
            // Path=/ ensures it works everywhere.
            return new Response(null, {
                status: 302,
                headers: {
                    "Set-Cookie": `admin_key=${key}; Path=/; Max-Age=2592000;`, // 30 days
                    Location: "/admin",
                },
            });
        } else {
            return new Response("Invalid key", { status: 401 });
        }
    } catch (error) {
        if (error instanceof Error) {
            console.error(error.message);
        }
    }
}
---

<BaseLayout title="‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö Admin">
    <div
        class="min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8"
    >
        <div
            class="max-w-md w-full space-y-8 bg-white p-10 rounded-2xl shadow-xl"
        >
            <div>
                <div
                    class="mx-auto h-20 w-20 bg-primary/10 rounded-full flex items-center justify-center text-4xl"
                >
                    üõ°Ô∏è
                </div>
                <h2
                    class="mt-6 text-center text-3xl font-extrabold text-gray-900"
                >
                    Admin Panel
                </h2>
                <p class="mt-2 text-center text-sm text-gray-600">
                    ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                </p>
            </div>
            <form class="mt-8 space-y-6" action="/admin/login" method="POST">
                <div class="rounded-md shadow-sm -space-y-px">
                    <div>
                        <label for="key" class="sr-only">Secret Key</label>
                        <input
                            id="key"
                            name="key"
                            type="password"
                            required
                            class="appearance-none rounded-xl relative block w-full px-4 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-primary focus:border-primary focus:z-10 sm:text-sm"
                            placeholder="Secret Key"
                        />
                    </div>
                </div>

                <div>
                    <button
                        type="submit"
                        class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-xl text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary shadow-lg shadow-primary/30 transition-all"
                    >
                        <span
                            class="absolute left-0 inset-y-0 flex items-center pl-3"
                        >
                            üîí
                        </span>
                        ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                    </button>
                </div>
            </form>
        </div>
    </div>
</BaseLayout>

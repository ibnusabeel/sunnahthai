---
import BaseLayout from "../layouts/BaseLayout.astro";
import { BOOK_NAMES, getDynamicBookNames } from "../lib/api";

// SSR: Fetch dynamic book names from admin (fast parallel fetch)
// Falls back to BOOK_NAMES if API fails
let bookNames = { ...BOOK_NAMES };
try {
	const dynamicNames = await getDynamicBookNames();
	bookNames = { ...bookNames, ...dynamicNames };
} catch (e) {
	console.error("Failed to fetch dynamic book names:", e);
}

// Main books
const MAIN_BOOKS = [
	"bukhari",
	"muslim",
	"nasai",
	"tirmidhi",
	"abudawud",
	"ibnmajah",
];

// Coming Soon Books
const COMING_SOON_BOOKS = [
	{
		th: "‡∏°‡∏∏‡∏™‡∏ï‡∏±‡∏î‡∏£‡πá‡∏≠‡∏Å ‡∏≠‡∏±‡∏•-‡∏´‡∏≤‡∏Å‡∏¥‡∏°",
		ar: "ŸÖÿ≥ÿ™ÿØÿ±ŸÉ ÿßŸÑÿ≠ÿßŸÉŸÖ",
		count: 9588,
		icon: "üìó",
	},
	{
		th: "‡∏ã‡∏≠‡πÄ‡∏Æ‡∏µ‡∏¢‡∏∞‡∏Æ‡πå ‡∏≠‡∏¥‡∏ö‡∏ô‡∏∏ ‡∏´‡∏¥‡∏ö‡∏ö‡∏≤‡∏ô",
		ar: "ÿµÿ≠Ÿäÿ≠ ÿßÿ®ŸÜ ÿ≠ÿ®ŸëÿßŸÜ",
		count: 7500,
		icon: "üìò",
	},
	{
		th: "‡∏≠‡∏±‡∏•-‡∏°‡∏∏‡∏≠‡∏∫‡∏ç‡∏±‡∏° ‡∏≠‡∏±‡∏•-‡∏Å‡∏∞‡∏ö‡∏µ‡∏£",
		ar: "ÿßŸÑŸÖÿπÿ¨ŸÖ ÿßŸÑŸÉÿ®Ÿäÿ± ŸÑŸÑÿ∑ÿ®ÿ±ÿßŸÜŸä",
		count: 16000,
		icon: "üìô",
	},
	{
		th: "‡∏≠‡∏±‡∏™-‡∏™‡∏∏‡∏ô‡∏±‡∏ô ‡∏≠‡∏±‡∏•-‡∏Å‡∏∏‡∏ö‡∏£‡∏≠",
		ar: "ÿßŸÑÿ≥ŸÜŸÜ ÿßŸÑŸÉÿ®Ÿäÿ± ŸÑŸÑÿ®ŸäŸáŸÇŸä",
		count: 22000,
		icon: "üìì",
	},
];

// Book colors for pastel cards
const bookColors: Record<string, string> = {
	bukhari: "from-mint-soft to-mint-light border-mint",
	muslim: "from-sky-soft to-sky-light border-sky",
	lulu: "from-amber-100 to-amber-50 border-amber-300",
	nasai: "from-peach-soft to-peach-light border-peach",
	tirmidhi: "from-pink-soft to-pink-light border-pink",
	abudawud: "from-primary-soft to-lavender-light border-primary-light",
	ibnmajah: "from-lavender-light to-primary-soft border-lavender",
};

// API URL for client-side stats fetch
const API_URL = import.meta.env.PUBLIC_API_URL || "http://localhost:3000";
---

<BaseLayout title="‡∏ã‡∏∏‡∏ô‡∏ô‡∏∞‡∏´‡πå‡πÑ‡∏ó‡∏¢ | ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å">
	<!-- Hero Section -->
	<section class="relative overflow-hidden py-16 md:py-5">
		<!-- Quran Section -->
		<section class="container mx-auto px-4 py-8">
			<a
				href="/quran"
				class="block group relative overflow-hidden rounded-3xl bg-gradient-to-br from-emerald-600 via-teal-600 to-cyan-600 p-8 md:p-12 shadow-xl hover:shadow-2xl transition-all duration-300 hover:-translate-y-1 border border-white/20"
			>
				<!-- Background Pattern -->
				<div class="absolute inset-0 opacity-10 mix-blend-overlay">
					<div
						class="absolute inset-0"
						style="background-image: url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 60 60%22><circle cx=%2230%22 cy=%2230%22 r=%2228%22 fill=%22none%22 stroke=%22white%22 stroke-width=%221%22/></svg>'); background-size: 60px 60px;"
					>
					</div>
				</div>

				<!-- Glowing orbs -->
				<div
					class="absolute top-0 right-0 w-80 h-80 bg-white/20 rounded-full blur-3xl -translate-y-1/2 translate-x-1/4 group-hover:scale-110 transition-transform duration-700"
				>
				</div>
				<div
					class="absolute bottom-0 left-0 w-60 h-60 bg-emerald-400/20 rounded-full blur-3xl translate-y-1/3 -translate-x-1/4"
				>
				</div>

				<div
					class="relative z-10 flex flex-col md:flex-row items-center justify-between gap-8 text-center md:text-left"
				>
					<div class="flex-1 space-y-4">
						<div
							class="inline-flex items-center gap-2 px-4 py-1.5 bg-white/20 backdrop-blur-md rounded-full border border-white/30 text-white font-medium text-sm shadow-sm hover:bg-white/30 transition-colors"
						>
							<span class="animate-pulse">‚ú®</span>
							<span>‡∏û‡∏£‡∏∞‡∏î‡∏≥‡∏£‡∏±‡∏™‡∏Ç‡∏≠‡∏á‡∏≠‡∏±‡∏•‡∏•‡∏≠‡∏Æ‡πå</span>
						</div>

						<div>
							<h2
								class="text-4xl md:text-5xl font-bold text-white mb-2 drop-shadow-md tracking-tight"
							>
								‡∏≠‡∏±‡∏•‡∏Å‡∏∏‡∏£‡∏≠‡∏≤‡∏ô & ‡∏ï‡∏±‡∏ü‡∏ã‡∏µ‡∏£
							</h2>
						</div>

						<p
							class="text-white/90 text-lg max-w-2xl leading-relaxed drop-shadow-sm"
						>
							‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏±‡∏•‡∏Å‡∏∏‡∏£‡∏≠‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢
							(‡∏ï‡∏±‡∏ü‡∏ã‡∏µ‡∏£) ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î <br class="hidden md:block" />
							‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏™‡∏ô‡πÉ‡∏à‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
						</p>

						<!-- Feature badges -->
						<div
							class="flex flex-wrap gap-3 mt-6 justify-center md:justify-start"
						>
							<span
								class="px-3 py-1.5 bg-white/10 backdrop-blur rounded-lg text-white text-sm border border-white/20 flex items-center gap-2"
							>
								<span>üìú</span> ‡∏ï‡∏±‡∏ü‡∏ã‡∏µ‡∏£‡∏ç‡∏∞‡∏•‡∏≤‡∏•‡∏±‡∏¢‡∏ô‡πå
							</span>
							<span
								class="px-3 py-1.5 bg-white/10 backdrop-blur rounded-lg text-white text-sm border border-white/20 flex items-center gap-2"
							>
								<span>üìò</span> ‡∏ï‡∏±‡∏ü‡∏ã‡∏µ‡∏£‡∏≠‡∏±‡∏ã-‡∏ã‡∏∞‡∏≠‡πå‡∏î‡∏µ‡∏¢‡πå
							</span>
							<span
								class="px-3 py-1.5 bg-white/10 backdrop-blur rounded-lg text-white text-sm border border-white/20 flex items-center gap-2"
							>
								<span>üáπüá≠</span> ‡πÅ‡∏õ‡∏•‡πÑ‡∏ó‡∏¢
							</span>
						</div>
					</div>

					<div
						class="flex-shrink-0 relative group-hover:scale-105 transition-transform duration-500"
					>
						<div
							class="w-32 h-32 md:w-40 md:h-40 bg-gradient-to-br from-white/20 to-white/5 backdrop-blur-md rounded-3xl flex items-center justify-center text-7xl md:text-8xl shadow-2xl border border-white/40 ring-1 ring-white/20 rotate-3 group-hover:rotate-6 transition-all duration-500"
						>
							üìñ
						</div>
						<!-- Decorative sparkles -->
						<div
							class="absolute -top-6 -right-6 text-4xl animate-bounce"
							style="animation-delay: 0s;"
						>
							‚ú®
						</div>
						<div
							class="absolute -bottom-4 -left-8 text-3xl animate-bounce"
							style="animation-delay: 0.5s;"
						>
							üåü
						</div>
					</div>
				</div>
			</a>
		</section>
		<!-- Decorative blobs -->
		<div
			class="absolute top-20 right-10 w-72 h-72 bg-pink-light/40 blob blur-3xl"
		>
		</div>
		<div
			class="absolute top-40 left-10 w-64 h-64 bg-primary-light/30 blob blur-3xl"
		>
		</div>
		<div
			class="absolute bottom-10 right-1/4 w-48 h-48 bg-mint-light/40 blob blur-3xl"
		>
		</div>

		<div class="container mx-auto px-4 relative z-10 md:py-20">
			<div class="text-center max-w-3xl mx-auto animate-fade-in">
				<h1
					class="text-4xl md:text-5xl lg:text-6xl font-bold text-text mb-4"
				>
					‡∏Ñ‡∏•‡∏±‡∏á<span class="text-gradient">‡∏õ‡∏±‡∏ç‡∏ç‡∏≤</span>‡πÅ‡∏´‡πà‡∏á‡∏´‡∏∞‡∏î‡∏µ‡∏©
				</h1>

				<p class="text-lg text-text-muted mb-8 max-w-xl mx-auto">
					‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏´‡∏∞‡∏î‡∏µ‡∏©‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏´‡∏•‡∏±‡∏Å ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢
				</p>

				<!-- Search Bar -->
				<form action="/search" method="get" class="max-w-xl mx-auto">
					<div class="relative flex gap-2">
						<input
							type="text"
							name="q"
							placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏∞‡∏î‡∏µ‡∏©..."
							class="input pl-5 pr-4 py-4 text-lg shadow-soft bg-white/80 flex-1 rounded-2xl border-none"
						/>
					</div>
				</form>
			</div>
		</div>
	</section>

	<!-- Stats Section - Client Hydrated -->
	<section class="container mx-auto px-4 -mt-4 relative z-10">
		<div class="grid grid-cols-2 md:grid-cols-4 gap-4">
			<div
				class="stat-card bg-gradient-to-br from-mint-soft to-white border-2 border-mint-light"
			>
				<div class="stat-value" id="stat-total">
					<span
						class="animate-pulse bg-gray-200 rounded w-16 h-6 inline-block"
					></span>
				</div>
				<div class="stat-label">üìö ‡∏´‡∏∞‡∏î‡∏µ‡∏©‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
			</div>
			<div
				class="stat-card bg-gradient-to-br from-primary-soft to-white border-2 border-primary-light"
			>
				<div class="stat-value" id="stat-translated">
					<span
						class="animate-pulse bg-gray-200 rounded w-16 h-6 inline-block"
					></span>
				</div>
				<div class="stat-label">‚ú® ‡πÅ‡∏õ‡∏•‡πÅ‡∏•‡πâ‡∏ß</div>
			</div>
			<div
				class="stat-card bg-gradient-to-br from-peach-soft to-white border-2 border-peach-light"
			>
				<div class="stat-value" id="stat-pending">
					<span
						class="animate-pulse bg-gray-200 rounded w-16 h-6 inline-block"
					></span>
				</div>
				<div class="stat-label">‚è≥ ‡∏£‡∏≠‡πÅ‡∏õ‡∏•</div>
			</div>
			<div
				class="stat-card bg-gradient-to-br from-pink-soft to-white border-2 border-pink-light"
			>
				<div class="stat-value" id="stat-percentage">
					<span
						class="animate-pulse bg-gray-200 rounded w-12 h-6 inline-block"
					></span>
				</div>
				<div class="stat-label">üéØ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</div>
			</div>
		</div>
	</section>

	<!-- Books Section - ALL 6 BOOKS -->
	<section class="container mx-auto px-4 py-16">
		<div class="text-center mb-12">
			<h2 class="text-2xl md:text-3xl font-bold text-text mb-3">
				üå∏ ‡∏Ñ‡∏•‡∏±‡∏á‡∏´‡∏∞‡∏î‡∏µ‡∏©
			</h2>
			<p class="text-text-muted">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏´‡∏∞‡∏î‡∏µ‡∏©‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô</p>
		</div>

		<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-6xl mx-auto">
			{
				MAIN_BOOKS.map((key) => {
					const book = bookNames[key] || BOOK_NAMES[key];
					if (!book) return null;
					const colorClass =
						bookColors[key] ||
						"from-gray-100 to-white border-gray-200";
					return (
						<a
							href={`/${key}`}
							class={`group relative overflow-hidden rounded-2xl border-2 bg-gradient-to-br ${colorClass} p-6 hover:shadow-glow hover:-translate-y-2 transition-all duration-300`}
							data-book={key}
						>
							{/* Decorative blob */}
							<div class="absolute -top-8 -right-8 w-24 h-24 rounded-full bg-white/30 blur-xl group-hover:scale-150 transition-transform duration-500" />

							{/* Icon - Larger and centered */}
							<div class="flex justify-center mb-4">
								<div class="w-20 h-20 rounded-2xl bg-white/70 backdrop-blur flex items-center justify-center text-5xl group-hover:scale-110 transition-transform shadow-lg border border-white/50">
									{book.icon}
								</div>
							</div>

							{/* Text - Centered */}
							<div class="text-center relative z-10">
								<h3 class="font-bold text-xl text-text group-hover:text-primary-dark transition-colors mb-1">
									{book.th}
								</h3>
								<p class="font-arabic text-primary text-xl text-base mb-4">
									{book.ar}
								</p>

								{/* Hadith Count - Client Hydrated */}
								<div
									class="space-y-3 book-stats"
									data-book={key}
								>
									<div class="flex justify-center gap-3">
										<div class="px-3 py-1.5 rounded-lg bg-white/60 backdrop-blur border border-white/50">
											<span class="text-lg font-bold text-text book-total">
												<span class="animate-pulse bg-gray-200 rounded w-10 h-4 inline-block" />
											</span>
											<span class="text-xs text-text-muted ml-1">
												‡∏´‡∏∞‡∏î‡∏µ‡∏©
											</span>
										</div>
										<div class="px-3 py-1.5 rounded-lg bg-mint/30 backdrop-blur border border-mint/50">
											<span class="text-lg font-bold text-emerald-700 book-translated">
												<span class="animate-pulse bg-gray-200 rounded w-8 h-4 inline-block" />
											</span>
											<span class="text-xs text-emerald-600 ml-1">
												‡πÅ‡∏õ‡∏•‡πÅ‡∏•‡πâ‡∏ß
											</span>
										</div>
									</div>

									{/* Progress Bar */}
									<div class="flex items-center gap-2">
										<div class="flex-1 h-3 bg-white/60 rounded-full overflow-hidden shadow-inner">
											<div
												class="h-full bg-gradient-to-r from-primary to-pink rounded-full transition-all book-progress"
												style="width: 0%"
											/>
										</div>
										<span class="text-sm font-bold text-primary book-percentage">
											0%
										</span>
									</div>
								</div>
							</div>
						</a>
					);
				})
			}
		</div>
	</section>

	<!-- Other Books Section - Client Hydrated -->
	<section
		id="other-books-section"
		class="container mx-auto px-4 pb-16 hidden"
	>
		<div class="text-center mb-8">
			<h2 class="text-xl md:text-2xl font-bold text-text mb-2">
				üìö ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏≠‡∏∑‡πà‡∏ô‡πÜ
			</h2>
			<p class="text-text-muted text-sm">
				‡∏´‡∏∞‡∏î‡∏µ‡∏©‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Ñ‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
			</p>
		</div>

		<div
			id="other-books-container"
			class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-5xl mx-auto"
		>
			<!-- Populated by JavaScript -->
		</div>
	</section>

	<!-- Coming Soon Section -->
	<section class="container mx-auto px-4 pb-16">
		<div class="text-center mb-8">
			<h2
				class="text-xl md:text-2xl font-bold text-text mb-2 animate-pulse"
			>
				üöß ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï (‡∏≠‡∏¥‡∏ô‡∏ä‡∏≤‡∏≠‡∏±‡∏•‡∏•‡∏≠‡∏Æ‡∏∫)
			</h2>
			<p class="text-text-muted text-sm">
				‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡∏•‡∏á‡∏£‡∏∞‡∏ö‡∏ö
			</p>
		</div>

		<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-5xl mx-auto">
			{
				COMING_SOON_BOOKS.map((book) => (
					<div class="group relative overflow-hidden rounded-2xl border-2 border-dashed border-gray-200 bg-gray-50/50 p-5 opacity-80 hover:opacity-100 transition-opacity">
						<div class="flex items-center gap-4 relative z-10">
							<div class="w-14 h-14 rounded-xl bg-gray-100 flex items-center justify-center text-3xl grayscale group-hover:grayscale-0 transition-all">
								{book.icon}
							</div>
							<div class="flex-1 min-w-0">
								<h3 class="font-bold text-base text-gray-700">
									{book.th}
								</h3>
								<p
									class="font-arabic text-sm text-gray-500"
									dir="rtl"
								>
									{book.ar}
								</p>
								<div class="flex items-center gap-2 text-sm mt-1">
									<span class="text-gray-400">
										‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì {book.count.toLocaleString()}{" "}
										‡∏´‡∏∞‡∏î‡∏µ‡∏©
									</span>
									<span class="px-2 py-0.5 rounded-full bg-gray-200 text-gray-600 text-xs font-medium">
										‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ
									</span>
								</div>
							</div>
						</div>
					</div>
				))
			}
		</div>
	</section>

	<!-- Features Section -->
	<section class="py-16">
		<div class="container mx-auto px-4">
			<div class="grid md:grid-cols-3 gap-8 max-w-4xl mx-auto">
				<div
					class="text-center card bg-gradient-to-br from-mint-soft to-white border-2 border-mint-light"
				>
					<div
						class="w-14 h-14 rounded-full bg-mint flex items-center justify-center mx-auto mb-4"
					>
						<span class="text-2xl">üîç</span>
					</div>
					<h3 class="font-bold text-text mb-2">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏á‡πà‡∏≤‡∏¢</h3>
					<p class="text-sm text-text-muted">
						‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏∞‡∏î‡∏µ‡∏©‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô ‡∏ó‡∏±‡πâ‡∏á‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏´‡∏£‡∏±‡∏ö
					</p>
				</div>
				<div
					class="text-center card bg-gradient-to-br from-pink-soft to-white border-2 border-pink-light"
				>
					<div
						class="w-14 h-14 rounded-full bg-pink flex items-center justify-center mx-auto mb-4"
					>
						<span class="text-2xl">üì±</span>
					</div>
					<h3 class="font-bold text-text mb-2">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå</h3>
					<p class="text-sm text-text-muted">
						‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏õ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï
					</p>
				</div>
				<div
					class="text-center card bg-gradient-to-br from-primary-soft to-white border-2 border-primary-light"
				>
					<div
						class="w-14 h-14 rounded-full bg-primary-light flex items-center justify-center mx-auto mb-4"
					>
						<span class="text-2xl">‚ú®</span>
					</div>
					<h3 class="font-bold text-text mb-2">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á</h3>
					<p class="text-sm text-text-muted">
						‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•‡πÉ‡∏´‡∏°‡πà‡πÜ ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô
					</p>
				</div>
			</div>
		</div>
	</section>
</BaseLayout>

<script define:vars={{ API_URL, MAIN_BOOKS, bookNames: BOOK_NAMES }}>
	// Client-side hydration: Fetch stats after page loads
	const API_BASE = API_URL;

	// Fetch overall stats
	async function fetchOverallStats() {
		try {
			const res = await fetch(`${API_BASE}/api/stats`);
			if (!res.ok) throw new Error("Failed to fetch stats");
			const data = await res.json();

			document.getElementById("stat-total").textContent =
				data.overall.total.toLocaleString();
			document.getElementById("stat-translated").textContent =
				data.overall.translated.toLocaleString();
			document.getElementById("stat-pending").textContent =
				data.overall.pending.toLocaleString();
			document.getElementById("stat-percentage").textContent =
				data.overall.percentage + "%";
		} catch (e) {
			console.error("Failed to fetch overall stats:", e);
		}
	}

	// Fetch individual book stats
	async function fetchBookStats(bookKey) {
		try {
			const res = await fetch(`${API_BASE}/api/stats/${bookKey}`);
			if (!res.ok) throw new Error("Failed to fetch book stats");
			const data = await res.json();
			return data;
		} catch {
			return null;
		}
	}

	// Update book card stats
	async function updateBookCards() {
		const allBookKeys = [...MAIN_BOOKS];

		// Fetch all book stats in parallel
		const results = await Promise.all(allBookKeys.map(fetchBookStats));

		results.forEach((stats, index) => {
			const bookKey = allBookKeys[index];
			if (!stats) return;

			const card = document.querySelector(
				`[data-book="${bookKey}"] .book-stats`,
			);
			if (!card) return;

			const totalEl = card.querySelector(".book-total");
			const translatedEl = card.querySelector(".book-translated");
			const progressEl = card.querySelector(".book-progress");
			const percentageEl = card.querySelector(".book-percentage");

			if (totalEl)
				totalEl.textContent = stats.overall.total.toLocaleString();
			if (translatedEl)
				translatedEl.textContent =
					stats.overall.translated.toLocaleString();
			if (progressEl)
				progressEl.style.width = stats.overall.percentage + "%";
			if (percentageEl)
				percentageEl.textContent = stats.overall.percentage + "%";
		});
	}

	// Fetch other books
	async function fetchOtherBooks() {
		try {
			const res = await fetch(`${API_BASE}/api/books`);
			if (!res.ok) throw new Error("Failed to fetch books");
			const data = await res.json();

			// Filter out main books
			const otherBooks = data.books.filter(
				(b) => !MAIN_BOOKS.includes(b.book),
			);

			if (otherBooks.length === 0) return;

			// Sort other books
			const PREFERRED_ORDER = [
				"lulu",
				"adab",
				"malik",
				"darimi",
				"ahmad",
			];
			otherBooks.sort((a, b) => {
				const idxA = PREFERRED_ORDER.indexOf(a.book);
				const idxB = PREFERRED_ORDER.indexOf(b.book);
				if (idxA !== -1 && idxB !== -1) return idxA - idxB;
				if (idxA !== -1) return -1;
				if (idxB !== -1) return 1;
				return 0;
			});

			// Render other books
			const container = document.getElementById("other-books-container");
			const section = document.getElementById("other-books-section");

			if (!container || !section) return;

			const colors = [
				"from-amber-100 to-amber-50 border-amber-200",
				"from-cyan-100 to-cyan-50 border-cyan-200",
				"from-rose-100 to-rose-50 border-rose-200",
				"from-violet-100 to-violet-50 border-violet-200",
				"from-teal-100 to-teal-50 border-teal-200",
				"from-fuchsia-100 to-fuchsia-50 border-fuchsia-200",
			];
			const icons = ["üìú", "üìï", "üìó", "üìò", "üìô", "üìì"];

			container.innerHTML = otherBooks
				.map((book, i) => {
					const colorClass = colors[i % colors.length];
					// Use th, ar, icon directly from API response (admin-editable)
					const bookTh = book.th || book.book;
					const bookAr = book.ar || "";
					const bookIcon = book.icon || icons[i % icons.length];

					return `
					<a href="/${book.book}" class="group relative overflow-hidden rounded-2xl border-2 bg-gradient-to-br ${colorClass} p-5 hover:shadow-glow hover:-translate-y-2 transition-all duration-300">
						<div class="absolute -top-6 -right-6 w-20 h-20 rounded-full bg-white/40 blur-xl group-hover:scale-150 transition-transform duration-500"></div>
						<div class="flex items-center gap-4 relative z-10">
							<div class="w-14 h-14 rounded-xl bg-white/70 backdrop-blur flex items-center justify-center text-3xl group-hover:scale-110 transition-transform shadow-sm">
								${bookIcon}
							</div>
							<div class="flex-1 min-w-0">
								<h3 class="font-bold text-base text-text group-hover:text-primary-dark transition-colors">${bookTh}</h3>
								${bookAr ? `<p class="font-arabic text-sm text-text-muted" dir="rtl">${bookAr}</p>` : ""}
								<div class="flex items-center gap-3 text-sm mt-1">
									<span class="text-text-muted">${book.total.toLocaleString()} ‡∏´‡∏∞‡∏î‡∏µ‡∏©</span>
									<span class="px-2 py-0.5 rounded-full bg-emerald-100 text-emerald-700 text-xs font-medium">${book.translated.toLocaleString()} ‡πÅ‡∏õ‡∏•‡πÅ‡∏•‡πâ‡∏ß</span>
								</div>
							</div>
						</div>
						<div class="mt-4 flex items-center gap-2">
							<div class="flex-1 h-2 bg-white/60 rounded-full overflow-hidden shadow-inner">
								<div class="h-full bg-gradient-to-r from-primary to-pink rounded-full transition-all" style="width: ${book.percentage}%"></div>
							</div>
							<span class="text-xs font-bold text-primary">${book.percentage}%</span>
						</div>
					</a>
				`;
				})
				.join("");

			// Show the section
			section.classList.remove("hidden");
		} catch (e) {
			console.error("Failed to fetch other books:", e);
		}
	}

	// Run all fetches in parallel when page loads
	document.addEventListener("DOMContentLoaded", () => {
		fetchOverallStats();
		updateBookCards();
		fetchOtherBooks();
	});
</script>

---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getSurahThai } from "../../lib/quran-data";

const API_URL = import.meta.env.PUBLIC_API_URL || "http://localhost:3000";
const { surah: surahId } = Astro.params as { surah: string };

// Fetch surah data
interface Ayah {
  verse_key: string;
  ayah_no: number;
  text_uthmani: string;
  translation_th: string;
  tafsir_ar: string;
  tafsir_th: string | null;
}

interface Surah {
  id: number;
  name_arabic: string;
  name_simple: string;
  name_complex: string;
  verses_count: number;
  revelation_place: string;
}

interface TafsirAssadi {
  surah_id: number;
  ayah_start: number;
  ayah_end: number;
  text_ar: string;
  text_th?: string;
}

let surah: Surah | null = null;
let ayahs: Ayah[] = [];
let tafsirAssadiList: TafsirAssadi[] = [];
let nextSurah: number | null = null;
let prevSurah: number | null = null;

try {
  const res = await fetch(`${API_URL}/api/quran/surah/${surahId}`);
  if (res.ok) {
    const data = await res.json();
    surah = data.surah;
    ayahs = data.ayahs || [];
    
    const id = parseInt(surahId);
    prevSurah = id > 1 ? id - 1 : null;
    nextSurah = id < 114 ? id + 1 : null;
    
    // Fetch As-Sa'di tafsir
    try {
      const tafsirRes = await fetch(`${API_URL}/api/quran/tafsir/assadi/${surahId}`);
      if (tafsirRes.ok) {
        const tafsirData = await tafsirRes.json();
        tafsirAssadiList = tafsirData.tafsirs || [];
      }
    } catch (e) {
      console.error("Failed to fetch As-Sa'di tafsir:", e);
    }
  }
} catch (error) {
  console.error("Failed to fetch surah:", error);
}

// Get Thai info
const surahInfo = surah ? getSurahThai(surah.id) : null;
const prevInfo = prevSurah ? getSurahThai(prevSurah) : null;
const nextInfo = nextSurah ? getSurahThai(nextSurah) : null;

// Bismillah - shown for all surahs except At-Tawbah (9)
const showBismillah = surah && surah.id !== 9 && surah.id !== 1;

// Thai numbering
const thaiNumerals = ['‡πê', '‡πë', '‡πí', '‡πì', '‡πî', '‡πï', '‡πñ', '‡πó', '‡πò', '‡πô'];
function toThaiNumeral(num: number): string {
  return String(num).split('').map(d => thaiNumerals[parseInt(d)]).join('');
}

// Helper to find As-Sa'di tafsir for an ayah
function findAssadiTafsir(ayahNo: number): TafsirAssadi | undefined {
  return tafsirAssadiList.find(t => ayahNo >= t.ayah_start && ayahNo <= t.ayah_end);
}

// Helper to wrap Arabic text with font-arabic class
function wrapArabicText(text: string): string {
  // Regex to match Arabic Unicode range (including extended)
  const arabicRegex = /[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+(?:\s*[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+)*/g;
  
  return text.replace(arabicRegex, (match) => 
    `<span class="font-arabic text-lg" dir="rtl">${match}</span>`
  );
}
---

<BaseLayout title={surahInfo ? `${surahInfo.name} | ‡∏≠‡∏±‡∏•‡∏Å‡∏∏‡∏£‡∏≠‡∏≤‡∏ô` : '‡∏≠‡∏±‡∏•‡∏Å‡∏∏‡∏£‡∏≠‡∏≤‡∏ô'}>
  {surah ? (
    <>
      <!-- Hero Header -->
      <section class="relative py-16 md:py-20 bg-gradient-to-br from-emerald-600 via-teal-600 to-cyan-700 overflow-hidden">
        <!-- Background Pattern -->
        <div class="absolute inset-0 opacity-5">
          <div class="absolute inset-0" style="background-image: url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 60 60%22><circle cx=%2230%22 cy=%2230%22 r=%2228%22 fill=%22none%22 stroke=%22white%22 stroke-width=%220.5%22/></svg>'); background-size: 60px 60px;"></div>
        </div>

        <!-- Glowing orbs -->
        <div class="absolute top-10 right-20 w-64 h-64 bg-yellow-300/20 rounded-full blur-3xl"></div>
        <div class="absolute bottom-10 left-20 w-80 h-80 bg-emerald-300/20 rounded-full blur-3xl"></div>

        <div class="container mx-auto px-4 relative z-10">
          <div class="max-w-4xl mx-auto text-center">
            <!-- Back Button -->
            <a 
              href="/quran" 
              class="inline-flex items-center gap-2 text-white/80 hover:text-white mb-8 transition-colors"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
              ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡∏π‡πÄ‡∏£‡∏≤‡∏∞‡∏´‡πå
            </a>

            <!-- Surah Number Badge -->
            <div class="inline-flex items-center justify-center w-20 h-20 bg-white/20 backdrop-blur-md rounded-3xl shadow-2xl mb-6 border border-white/30">
              <span class="text-3xl font-bold text-white">{surah.id}</span>
            </div>

            <!-- Surah Name -->
            <!-- Surah Name -->
            <h1 class="text-4xl md:text-5xl font-arabic text-white mb-3 drop-shadow-lg" dir="rtl">
              ÿ≥ŸèŸàÿ±Ÿéÿ©Ÿè {surah.name_arabic}
            </h1>
            <p class="text-2xl text-white/90 mb-2 font-bold">
              {surahInfo?.name}
            </p>
            <p class="text-lg text-white/80 mb-8">
              {surahInfo?.meaning && `"${surahInfo.meaning}" ‚Ä¢ `}
              {surah.revelation_place === 'makkah' ? 'üïã ‡∏°‡∏±‡∏Å‡∏Å‡∏µ‡∏¢‡∏∞‡∏´‡πå' : 'üïå ‡∏°‡∏∞‡∏î‡∏∞‡∏ô‡∏µ‡∏¢‡∏∞‡∏´‡πå'} ‚Ä¢ {surah.verses_count} ‡∏≠‡∏≤‡∏¢‡∏∞‡∏´‡πå
            </p>

            <!-- Navigation -->
            <div class="flex justify-center gap-4">
              {prevSurah && (
                <a 
                  href={`/quran/${prevSurah}`}
                  class="px-5 py-2 bg-white/20 backdrop-blur-sm rounded-full text-white hover:bg-white/30 transition-colors border border-white/30 truncate max-w-[160px]"
                >
                  ‚Üê {prevInfo?.name}
                </a>
              )}
              {nextSurah && (
                <a 
                  href={`/quran/${nextSurah}`}
                  class="px-5 py-2 bg-white/20 backdrop-blur-sm rounded-full text-white hover:bg-white/30 transition-colors border border-white/30 truncate max-w-[160px]"
                >
                  {nextInfo?.name} ‚Üí
                </a>
              )}
            </div>
          </div>
        </div>

        <!-- Wave divider -->
        <div class="absolute bottom-0 left-0 right-0">
          <svg viewBox="0 0 1440 100" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full">
            <path d="M0 100L60 90C120 80 240 60 360 55C480 50 600 60 720 65C840 70 960 70 1080 70C1200 70 1320 70 1380 70L1440 70V100H0Z" fill="#F8FAFC"/>
          </svg>
        </div>
      </section>

      <!-- Bismillah -->
      {showBismillah && (
        <div class="bg-slate-50 py-12 text-center">
          <div class="container mx-auto px-4">
            <p class="text-4xl md:text-5xl font-arabic text-emerald-700 leading-relaxed" dir="rtl">
              ÿ®Ÿêÿ≥ŸíŸÖŸê Ÿ±ŸÑŸÑŸéŸëŸáŸê Ÿ±ŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸÄŸ∞ŸÜŸê Ÿ±ŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖŸê
            </p>
            <p class="text-text-muted mt-3 text-lg">
              ‡∏î‡πâ‡∏ß‡∏¢‡∏û‡∏£‡∏∞‡∏ô‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏≠‡∏±‡∏•‡∏•‡∏≠‡∏Æ‡∏∫ ‡∏ú‡∏π‡πâ‡∏ó‡∏£‡∏á‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡∏£‡∏≤‡∏ô‡∏µ ‡∏ú‡∏π‡πâ‡∏ó‡∏£‡∏á‡πÄ‡∏°‡∏ï‡∏ï‡∏≤‡πÄ‡∏™‡∏°‡∏≠
            </p>
          </div>
        </div>
      )}

      <!-- Ayahs Section -->
      <section class="py-10 md:py-16 bg-slate-50">
        <div class="container mx-auto px-4 max-w-4xl">
          <!-- Reading Mode Toggle -->
          <div class="flex justify-end mb-8">
            <div class="inline-flex bg-white rounded-xl shadow-sm border border-gray-200 p-1">
              <button 
                id="mode-card" 
                class="mode-btn active px-4 py-2 rounded-lg text-sm font-medium bg-emerald-500 text-white"
              >
                üìñ ‡∏Å‡∏≤‡∏£‡πå‡∏î
              </button>
              <button 
                id="mode-flow" 
                class="mode-btn px-4 py-2 rounded-lg text-sm font-medium text-text-muted hover:bg-gray-100"
              >
                üìú ‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á
              </button>
            </div>
          </div>

          <!-- Ayahs List - Card Mode -->
          <div id="ayahs-cards" class="space-y-6">
            {ayahs.map((ayah, index) => (
              <article 
                class="ayah-card group bg-white rounded-3xl shadow-sm hover:shadow-xl transition-all duration-500 border border-gray-100 overflow-hidden"
                id={`ayah-${ayah.ayah_no}`}
              >
                <!-- Ayah Number Header -->
                <div class="bg-gradient-to-r from-emerald-500 to-teal-500 px-6 py-4 flex items-center justify-between">
                  <div class="flex items-center gap-4">
                    <!-- Decorative Ayah Number -->
                    <div class="relative">
                      <div class="w-14 h-14 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center border border-white/30 shadow-lg">
                        <span class="text-white font-bold text-xl">{ayah.ayah_no}</span>
                      </div>
                    </div>
                    <div>
                      <span class="text-white/90 text-sm">‡∏≠‡∏≤‡∏¢‡∏∞‡∏´‡πå‡∏ó‡∏µ‡πà</span>
                      <span class="text-white font-bold text-lg ml-1">{toThaiNumeral(ayah.ayah_no)}</span>
                    </div>
                  </div>
                  
                  <!-- Actions -->
                  <div class="flex items-center gap-2">
                    <button 
                      class="copy-btn p-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors"
                      data-verse={ayah.verse_key}
                      data-arabic={ayah.text_uthmani}
                      title="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å"
                    >
                      <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                      </svg>
                    </button>
                    <button 
                      class="share-btn p-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors"
                      data-verse={ayah.verse_key}
                      title="‡πÅ‡∏ä‡∏£‡πå"
                    >
                      <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
                      </svg>
                    </button>
                  </div>
                </div>

                <!-- Ayah Content -->
                <div class="p-6 md:p-8">
                  <!-- Arabic Text -->
                  <div class="mb-8">
                    <p 
                      class="font-arabic text-right text-text group-hover:text-emerald-800 transition-colors" 
                      style="font-size: 2rem; line-height: 2;"
                      dir="rtl"
                    >
                      {ayah.text_uthmani}
                      <span class="inline-flex items-center justify-center w-10 h-10 mx-2 bg-emerald-100 text-emerald-700 rounded-full text-lg align-middle">
                        {ayah.ayah_no}
                      </span>
                    </p>
                  </div>

                  <!-- Thai Translation -->
                  <div class="mb-6 p-5 bg-gradient-to-r from-emerald-50 to-teal-50 rounded-2xl border-l-4 border-emerald-400">
                    <div class="flex items-start gap-3">
                      <span class="text-2xl">üáπüá≠</span>
                      <div>
                        <p class="text-sm text-emerald-600 font-medium mb-1">‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</p>
                        <p class="text-text leading-relaxed text-lg">
                          {ayah.translation_th}
                        </p>
                      </div>
                    </div>
                  </div>

                  <!-- Tafsir Toggle -->
                  {ayah.tafsir_ar && (
                    <details class="group/tafsir">
                      <summary class="cursor-pointer flex items-center gap-3 p-4 bg-amber-50 rounded-2xl hover:bg-amber-100 transition-colors list-none">
                        <span class="text-xl">üìö</span>
                        <span class="font-medium text-amber-800">‡∏ï‡∏±‡∏ü‡∏ã‡∏µ‡∏£‡∏≠‡∏±‡∏•-‡∏ç‡∏∞‡∏•‡∏≤‡∏•‡∏±‡∏¢‡∏ô‡πå</span>
                        <svg class="w-5 h-5 text-amber-600 ml-auto transform group-open/tafsir:rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                      </summary>
                      <div class="mt-4 p-5 bg-amber-50/50 rounded-2xl border border-amber-200">
                        <p class="font-arabic text-xl leading-[2.2] text-text text-right" dir="rtl">
                          {ayah.tafsir_ar}
                        </p>
                        {ayah.tafsir_th && (
                          <div class="mt-4 pt-4 border-t border-amber-200">
                            <p class="text-text leading-relaxed">
                              {ayah.tafsir_th}
                            </p>
                          </div>
                        )}
                      </div>
                    </details>
                  )}

                  {/* As-Sa'di Tafsir Toggle */}
                  {(() => {
                    const assadi = findAssadiTafsir(ayah.ayah_no);
                    return assadi && (
                      <details class="group/assadi mt-3">
                        <summary class="cursor-pointer flex items-center gap-3 p-4 bg-blue-50 rounded-2xl hover:bg-blue-100 transition-colors list-none">
                          <span class="text-xl">üìò</span>
                          <span class="font-medium text-blue-800">
                            ‡∏ï‡∏±‡∏ü‡∏™‡∏µ‡∏£ ‡∏≠‡∏±‡∏™‡∏™‡∏∞‡∏≠‡∏∫‡∏î‡∏µ‡∏¢‡πå
                            {assadi.ayah_start !== assadi.ayah_end && (
                              <span class="text-blue-600 text-sm ml-2">
                                (ÿ¢Ÿäÿ© {assadi.ayah_start}-{assadi.ayah_end})
                              </span>
                            )}
                          </span>
                          <svg class="w-5 h-5 text-blue-600 ml-auto transform group-open/assadi:rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                          </svg>
                        </summary>
                        <div class="mt-4 p-5 bg-blue-50/50 rounded-2xl border border-blue-200">
                          <p class="font-arabic text-xl leading-[2.2] text-text text-right" dir="rtl">
                            {assadi.text_ar}
                          </p>
                          {assadi.text_th && (
                            <div class="mt-4 pt-4 border-t border-blue-200">
                              <p class="text-sm text-blue-600 font-medium mb-2">üáπüá≠ ‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</p>
                              <p 
                                class="text-text leading-relaxed whitespace-pre-wrap"
                                set:html={wrapArabicText(assadi.text_th)}
                              />
                            </div>
                          )}
                        </div>
                      </details>
                    );
                  })()}
                </div>
              </article>
            ))}
          </div>

          <!-- Ayahs Flow Mode (Hidden by default) -->
          <div id="ayahs-flow" class="hidden bg-white rounded-3xl p-8 shadow-sm border border-gray-100">
            <div class="text-right" dir="rtl">
              {ayahs.map((ayah) => (
                <span class="inline font-arabic text-text hover:text-emerald-700 cursor-pointer transition-colors" style="font-size: 2rem; line-height: 2;" id={`flow-${ayah.ayah_no}`}>
                  {ayah.text_uthmani}
                  <span class="inline-flex items-center justify-center w-8 h-8 mx-1 bg-emerald-100 text-emerald-700 rounded-full text-sm">
                    {ayah.ayah_no}
                  </span>
                </span>
              ))}
            </div>
          </div>

          <!-- Bottom Navigation -->
          <div class="mt-12 flex justify-between items-center">
            {prevSurah ? (
              <a 
                href={`/quran/${prevSurah}`}
                class="flex items-center gap-2 px-6 py-3 bg-white rounded-xl shadow-sm hover:shadow-md transition-all border border-gray-200 hover:border-emerald-300"
              >
                <svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                <div class="text-left">
                  <span class="text-xs text-text-muted block">‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</span>
                  <span class="text-text font-medium">{prevInfo?.name}</span>
                </div>
              </a>
            ) : <div></div>}
            
            <a 
              href="/quran"
              class="px-6 py-3 bg-emerald-500 text-white rounded-xl hover:bg-emerald-600 transition-colors shadow-lg hover:shadow-xl"
            >
              üìñ ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠
            </a>
            
            {nextSurah ? (
              <a 
                href={`/quran/${nextSurah}`}
                class="flex items-center gap-2 px-6 py-3 bg-white rounded-xl shadow-sm hover:shadow-md transition-all border border-gray-200 hover:border-emerald-300"
              >
                <div class="text-right">
                  <span class="text-xs text-text-muted block">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</span>
                  <span class="text-text font-medium">{nextInfo?.name}</span>
                </div>
                <svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </a>
            ) : <div></div>}
          </div>
        </div>
      </section>
    </>
  ) : (
    <!-- Error State -->
    <section class="py-32 text-center bg-slate-50">
      <div class="container mx-auto px-4">
        <div class="text-6xl mb-6">‚ùå</div>
        <h1 class="text-2xl font-bold text-text mb-4">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ã‡∏π‡πÄ‡∏£‡∏≤‡∏∞‡∏´‡πå</h1>
        <p class="text-text-muted mb-8">‡∏ã‡∏π‡πÄ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏´‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà</p>
        <a href="/quran" class="btn btn-primary">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏±‡∏•‡∏Å‡∏∏‡∏£‡∏≠‡∏≤‡∏ô</a>
      </div>
    </section>
  )}
</BaseLayout>

<script>
  // Mode toggle
  const modeCard = document.getElementById('mode-card');
  const modeFlow = document.getElementById('mode-flow');
  const ayahsCards = document.getElementById('ayahs-cards');
  const ayahsFlow = document.getElementById('ayahs-flow');

  modeCard?.addEventListener('click', () => {
    modeCard.classList.add('bg-emerald-500', 'text-white');
    modeCard.classList.remove('text-text-muted');
    modeFlow?.classList.remove('bg-emerald-500', 'text-white');
    modeFlow?.classList.add('text-text-muted');
    ayahsCards?.classList.remove('hidden');
    ayahsFlow?.classList.add('hidden');
  });

  modeFlow?.addEventListener('click', () => {
    modeFlow.classList.add('bg-emerald-500', 'text-white');
    modeFlow.classList.remove('text-text-muted');
    modeCard?.classList.remove('bg-emerald-500', 'text-white');
    modeCard?.classList.add('text-text-muted');
    ayahsFlow?.classList.remove('hidden');
    ayahsCards?.classList.add('hidden');
  });

  // Copy functionality
  document.querySelectorAll('.copy-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
      const arabic = (btn as HTMLElement).dataset.arabic;
      const verse = (btn as HTMLElement).dataset.verse;
      
      if (arabic) {
        try {
          await navigator.clipboard.writeText(`${arabic}\n\n[${verse}]`);
          // Show feedback
          const icon = btn.querySelector('svg');
          if (icon) {
            icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>';
            setTimeout(() => {
              icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>';
            }, 2000);
          }
        } catch (err) {
          console.error('Failed to copy:', err);
        }
      }
    });
  });

  // Share functionality
  document.querySelectorAll('.share-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
      const verse = (btn as HTMLElement).dataset.verse;
      const url = `${window.location.origin}/quran/${verse?.split(':')[0]}#ayah-${verse?.split(':')[1]}`;
      
      if (navigator.share) {
        try {
          await navigator.share({
            title: `Quran ${verse}`,
            url: url
          });
        } catch (err) {
          console.log('Share cancelled');
        }
      } else {
        await navigator.clipboard.writeText(url);
        alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß!');
      }
    });
  });
</script>

<style>
  .ayah-card {
    animation: fadeInUp 0.6s ease-out forwards;
    opacity: 0;
  }
  
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .ayah-card:nth-child(1) { animation-delay: 0.1s; }
  .ayah-card:nth-child(2) { animation-delay: 0.15s; }
  .ayah-card:nth-child(3) { animation-delay: 0.2s; }
  .ayah-card:nth-child(4) { animation-delay: 0.25s; }
  .ayah-card:nth-child(5) { animation-delay: 0.3s; }
  .ayah-card:nth-child(6) { animation-delay: 0.35s; }
  .ayah-card:nth-child(7) { animation-delay: 0.4s; }
  
  details summary::-webkit-details-marker {
    display: none;
  }
  

</style>
